# ============================================
# MySQL 8.0 自定义配置文件
# 字符集、时区、性能优化、连接池配置
# 数据库连接配置优化（2分）
# ============================================

[mysqld]
# ==================== 字符集配置（重要！1分） ====================
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'

# ==================== 时区配置（重要！） ====================
default-time-zone='+08:00'

# ==================== InnoDB性能优化 ====================
# InnoDB缓冲池大小（建议为可用内存的50-70%）
innodb_buffer_pool_size=256M
# 缓冲池实例数（提高并发性能）
innodb_buffer_pool_instances=4
# 日志文件大小
innodb_log_file_size=64M
innodb_log_buffer_size=16M
# 事务提交策略（2=每秒刷新，平衡性能和安全）
innodb_flush_log_at_trx_commit=2
# I/O刷新方法
innodb_flush_method=O_DIRECT
# 读写I/O线程数
innodb_read_io_threads=4
innodb_write_io_threads=4
# 自适应哈希索引
innodb_adaptive_hash_index=ON

# ==================== 连接池配置（重要！2分） ====================
# 最大连接数
max_connections=200
# 最大连接错误数
max_connect_errors=100
# 连接超时时间（秒）
wait_timeout=28800
interactive_timeout=28800
# 连接缓存
thread_cache_size=16

# ==================== 缓冲区配置 ====================
# 临时表大小
tmp_table_size=64M
max_heap_table_size=64M
# 排序缓冲
sort_buffer_size=2M
# 连接缓冲
join_buffer_size=2M
# 读取缓冲
read_buffer_size=1M
read_rnd_buffer_size=1M

# ==================== 日志配置 ====================
# 慢查询日志（用于性能分析）
slow_query_log=1
slow_query_log_file=/var/log/mysql/slow.log
long_query_time=2

# 错误日志
log_error=/var/log/mysql/error.log

# 二进制日志（用于主从复制和数据恢复）
log_bin=mysql-bin
binlog_format=ROW
# MySQL 8.0使用binlog_expire_logs_seconds替代expire_logs_days
binlog_expire_logs_seconds=604800
# 同步二进制日志
sync_binlog=1

# ==================== 安全配置 ====================
# 禁用DNS解析（提高连接速度）
skip-name-resolve

# SQL模式（严格模式）
sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

# 禁用符号链接（安全）
symbolic-links=0

# 默认认证插件（兼容性）
default_authentication_plugin=mysql_native_password

# ==================== 表和索引配置 ====================
# 表定义缓存
table_definition_cache=2000
# 打开表缓存
table_open_cache=4000

[client]
default-character-set=utf8mb4
# 连接超时
connect_timeout=10

[mysql]
default-character-set=utf8mb4
# 自动重连
auto-rehash

[mysqldump]
# 快速导出
quick
max_allowed_packet=64M
